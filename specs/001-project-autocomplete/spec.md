# Feature Specification: Project Autocomplete

**Feature Branch**: `001-project-autocomplete`  
**Created**: 2026年2月6日  
**Status**: Draft  
**Input**: User description: "ユーザーとして、プロジェクトを選択する時、オートコンプリートによる絞り込みがしたい。なぜなら、数十件あるプロジェクトの中から目的のプロジェクトを探すのは困難なため。"

## Clarifications

### Session 2026-02-07

- Q: Should autocomplete filtering be client-side or server-side? → A: Client-side filtering of the already-loaded project list.
- Q: What matching rule should autocomplete use? → A: Partial match (contains).
- Q: What debounce delay should be used for input filtering? → A: 150ms.
- Q: What minimum input length should trigger filtering? → A: 1 character (empty shows all).
- Q: What maximum number of results should be shown? → A: 100 results with a prompt to refine.
- Q: How should suggestions be presented? → A: Dropdown (combobox) under the input.

## User Scenarios & Testing _(mandatory)_

### User Story 1 - Basic Project Search (Priority: P1)

ユーザーがプロジェクト名の一部を入力すると、リアルタイムに候補が絞り込まれる。コミット収集画面と集計表示画面（プロジェクト別表示）の両方で使用される。これにより、数十件のプロジェクトリストをスクロールせずに、目的のプロジェクトを素早く見つけられる。

**Why this priority**: これは最も基本的で重要な機能。複数の画面で必要とされており、現在のドロップダウンリストではプロジェクトが多い場合に使いにくいという課題を直接解決する。

**Independent Test**:

- コミット収集画面のプロジェクト選択フィールドで、プロジェクト名を入力し、候補リストが正しく絞り込まれることを確認する
- 集計表示画面（プロジェクト別表示）のプロジェクト選択フィールドでも同様に動作することを確認する

**Acceptance Scenarios**:

1. **Given** コミット収集画面が表示されている、**When** ユーザーがプロジェクト選択フィールドに「ana」と入力する、**Then** プロジェクト名に「ana」を含むプロジェクト（例：「gitlab-analyzer」）のみが候補リストに表示される
2. **Given** 集計表示画面（プロジェクト別表示）のプロジェクト選択が表示されている、**When** ユーザーが「ana」と入力する、**Then** プロジェクト名に「ana」を含むプロジェクトのみが候補リストに表示される
3. **Given** 検索結果が表示されている、**When** ユーザーが検索文字列を削除する、**Then** すべてのプロジェクトが再び候補リストに表示される
4. **Given** 入力フィールドにテキストが入力されている、**When** 該当するプロジェクトが存在しない、**Then** 「該当するプロジェクトがありません」というメッセージが表示される
5. **Given** プロジェクト候補リストが表示されている、**When** ユーザーが候補をクリックまたは選択する、**Then** そのプロジェクトが選択され、関連する機能（ブランチ選択など）が有効になる

---

### User Story 2 - Path-based Search (Priority: P2)

ユーザーがプロジェクト名だけでなく、プロジェクトパス（pathWithNamespace）でも検索できる。グループ名やネームスペースで絞り込むことで、より柔軟な検索が可能になる。

**Why this priority**: プロジェクト名が似ている場合や、グループ/ネームスペースで管理されている場合に有用。基本的な名前検索だけでは不十分な場合の補完機能。

**Independent Test**: グループ名やネームスペースを含むパス（例：「mygroup/」）を入力し、そのグループに属するプロジェクトのみが表示されることを確認する。

**Acceptance Scenarios**:

1. **Given** プロジェクト選択画面が表示されている、**When** ユーザーが「group/sub」と入力する、**Then** pathWithNamespaceに「group/sub」を含むプロジェクトのみが表示される
2. **Given** プロジェクト選択画面が表示されている、**When** ユーザーが「acme」と入力する、**Then** プロジェクト名またはpathWithNamespaceに「acme」を含むすべてのプロジェクトが表示される（例：「acme-app」や「mygroup/acme-service」）

---

### User Story 3 - Keyboard Navigation (Priority: P3)

ユーザーがキーボードだけで検索から選択まで完結できる。マウスを使わずに操作できることで、効率的なワークフローが実現する。

**Why this priority**: キーボード操作はパワーユーザーにとって重要だが、マウス操作でも同じ目的を達成できる。アクセシビリティの観点からも重要だが、基本機能が動作すれば後からでも追加可能。

**Independent Test**: マウスを使わず、キーボードのみでプロジェクトを検索し選択できることを確認する。Tab、矢印キー、Enterキーだけで操作を完了できる。

**Acceptance Scenarios**:

1. **Given** プロジェクト選択画面が表示されている、**When** ユーザーが入力フィールドにフォーカスして検索テキストを入力し、下矢印キーを押す、**Then** 最初の候補がハイライトされる
2. **Given** 候補がハイライトされている、**When** ユーザーが上下矢印キーを押す、**Then** ハイライトが候補間を移動する
3. **Given** 候補がハイライトされている、**When** ユーザーがEnterキーを押す、**Then** ハイライトされたプロジェクトが選択される
4. **Given** 候補リストが開いている、**When** ユーザーがEscapeキーを押す、**Then** 候補リストが閉じ、フォーカスが入力フィールドに戻る

---

### Edge Cases

- 検索文字列が大文字と小文字を混在させた場合でも正しく検索できる（大文字小文字を区別しない検索）
- プロジェクト数が100件以上ある場合でも、検索パフォーマンスが低下しない
- 特殊文字（ハイフン、アンダースコア、スラッシュなど）を含むプロジェクト名やパスでも正しく検索できる
- 日本語を含むプロジェクト名でも検索できる
- ネットワーク遅延によりプロジェクトリストの取得が遅れた場合、ローディング状態が表示される
- プロジェクトが1件も登録されていない場合、適切なメッセージが表示される

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: システムはユーザーが入力した文字列に基づいて、プロジェクトリストをリアルタイムに絞り込まなければならない
- **FR-002**: システムはプロジェクト名（name）とプロジェクトパス（pathWithNamespace）の両方を検索対象としなければならない
- **FR-003**: システムは大文字小文字を区別しない検索を提供しなければならない
- **FR-004**: ユーザーは絞り込まれた候補から、クリックまたはキーボード（Enter）でプロジェクトを選択できなければならない
- **FR-005**: システムは検索結果が0件の場合、「該当するプロジェクトがありません」という明確なメッセージを表示しなければならない
- **FR-006**: システムはキーボードナビゲーション（上下矢印キー、Enter、Escape）をサポートしなければならない
- **FR-007**: システムは現在選択されているプロジェクトを視覚的に明示しなければならない
- **FR-008**: システムは検索入力フィールドをクリアする機能を提供しなければならない
- **FR-009**: システムは複数の画面（コミット収集画面、集計表示画面のプロジェクト別表示）でのプロジェクト選択で、統一されたオートコンプリート機能を提供しなければならない
- **FR-010**: システムは各画面でのプロジェクト選択後、関連する機能（ブランチ選択、データ更新など）が正常に動作しなければならない
- **FR-011**: システムはプロジェクトリストのローディング状態を適切に表示しなければならない
- **FR-012**: システムは取得済みのプロジェクト一覧をクライアント側で絞り込みしなければならない
- **FR-013**: システムは部分一致（入力文字列を含む）で候補を絞り込みしなければならない
- **FR-014**: システムは入力変更から150msのデバウンス後に絞り込みを実行しなければならない
- **FR-015**: システムは1文字以上の入力で絞り込みを開始し、空欄時は全件を表示しなければならない
- **FR-016**: システムは候補の表示件数を最大100件に制限し、超過時は絞り込みを促すメッセージを表示しなければならない
- **FR-017**: システムは入力欄の下にドロップダウン（コンボボックス）で候補を表示しなければならない

### Key Entities

- **Project**: GitLabプロジェクトを表すエンティティ
  - プロジェクトID（projectId）: プロジェクトを一意に識別する
  - プロジェクト名（name）: プロジェクトの表示名
  - プロジェクトパス（pathWithNamespace）: グループやネームスペースを含む完全なパス

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: ユーザーが3文字以上入力した時点で、検索結果が1秒以内に表示される
- **SC-002**: 100件以上のプロジェクトがある環境でも、検索パフォーマンスが低下せず、即座に結果が絞り込まれる
- **SC-003**: ユーザーがキーボードのみで、入力開始から選択完了までを5秒以内に完了できる
- **SC-004**: プロジェクト選択にかかる平均時間が、現在のドロップダウン方式と比較して50%以上短縮される
- **SC-005**: プロジェクト選択時のユーザーエラー（誤選択）が30%以上減少する
- **SC-006**: 日本語、英語、特殊文字を含むプロジェクト名で、95%以上の検索精度を実現する
